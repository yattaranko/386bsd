MALLOC(9)                  Kernel Developer‚Äôs Manual                 MALLOC(9)

[1mNAME[0m
       malloc ‚Äî kernel dynamic memory allocator

[1mSYNOPSIS[0m
       [1m#include "malloc.h"[0m

       [4mvoid[24m [4m*[0m
       [1mmalloc[22m([4mu_long[24m [4msize[24m, [4mint[24m [4mtype[24m, [4mint[24m [4mflags[24m);

       [4mvoid[0m
       [1mfree[22m([4mvoid[24m [4m*addr[24m, [4mint[24m [4mtype[24m);

[1mDESCRIPTION[0m
       Most shared resources in the 386BSD kernel are dynamically allocated on
       demand  to serve need (with administrative bounds present to avoid sys‚Äê
       tem overrun). The [1mmalloc[22m() function is used to allocate small (<= 64KB)
       portions of memory in the kernel, and is especially useful in  sub‚Äêpage
       sized  allocations, since it maintains a free pool of page fragments to
       allocate from.

       While this function superfically  resembles  the  user  mode  [4mmalloc[24m(3)
       function,  it has two additional arguments.  Associated with each allo‚Äê
       cation is a [4mtype[24m which tags allocations of a given kind for use in sta‚Äê
       tistics and run‚Äêaway allocation prevention. In addition, [1mmalloc[22m() has a
       [4mflags[24m argument to select optional handling (M_NOWAIT is the most common
       option, allowing the function to be used from interrupt level by disal‚Äê
       lowing a block if no space available).

       The [1mmalloc[22m() function obtains memory for its pool from the virtual mem‚Äê
       ory system via the [4mkmem[24m(9) facility.

       The [1mfree[22m() function returns used memory to the memory pool. If  a  sur‚Äê
       plus  of  memory is present in the allocator‚Äôs pool, it will attempt to
       return whole pages back to the [4mkmem[24m(9) facility. As such, it defers  to
       the virtual memory system as the primary location where memory resource
       resides.

       Since  the  virtual  memory system itself makes use of [1mmalloc[22m() for its
       operation, care is taken to avoid recursion.

[1mRETURN VALUES[0m
       The [1mmalloc[22m() function returns a address of the  allocated  resource  if
       successful; otherwise a null address is returned.

[1mSEE ALSO[0m
       [4mkmem[24m(9)

386BSD 1                        August 29, 1994                      MALLOC(9)
